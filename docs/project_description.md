# Telegram Bot для поздравлений с днем рождения

## Описание проекта
Простой Telegram бот, который принимает текстовые и голосовые сообщения от пользователей и генерирует поздравительные картинки с днем рождения на основе полученного текста. Использует современные технологии распознавания речи и обработки изображений.

## Основной функционал

### Команды
- `/start` - показывает приветственное сообщение и краткую инструкцию по использованию бота
- `/help` - отображает подробную справку по функциям бота

### Обработка сообщений
- **Текстовые сообщения**: напрямую используются для генерации изображения с красивым оформлением
- **Голосовые сообщения**: конвертируются в текст с помощью OpenAI Whisper, затем используются для генерации изображения
- **Неподдерживаемый контент**: бот вежливо объясняет, какие типы сообщений он может обработать

### Генерация изображений
- Создание красивых поздравительных картинок с градиентным фоном
- Автоматический перенос текста с учетом размеров изображения
- Декоративные элементы: рамки, тени, уголки
- Настраиваемые шрифты и цвета
- Поддержка различных размеров и форматов

### Распознавание речи
- Использует модель OpenAI Whisper для высокого качества распознавания
- Поддержка различных аудиоформатов (OGG, MP3, WAV, M4A, FLAC)
- Автоматическая конвертация аудио в оптимальный формат
- Настраиваемые модели Whisper (tiny, base, small, medium, large)
- Обработка аудио длительностью до 60 секунд

## Технический стек

### Основные библиотеки
- **aiogram 3.13.1** - современный фреймворк для создания Telegram ботов
- **Pillow** - создание и обработка изображений
- **OpenAI Whisper** - распознавание речи мирового класса
- **PyTorch + TorchAudio** - машинное обучение и обработка аудио

### Системные зависимости
- **FFmpeg** - обработка аудио и видео файлов
- **imageio-ffmpeg** - Python интерфейс для FFmpeg

### Утилиты разработки
- **watchdog** - автоматический перезапуск при изменениях
- **python-dotenv** - управление переменными окружения
- **PyYAML** - обработка конфигурационных файлов

## Архитектура

### Структура проекта
```
birthday_bot/
├── src/                    # Исходный код
│   ├── bot/               # Модули бота
│   │   ├── bot_instance.py # Менеджер бота
│   │   └── handlers.py    # Обработчики сообщений
│   ├── speech/            # Распознавание речи
│   │   ├── speech_to_text.py
│   │   └── audio_processor.py
│   ├── image/             # Генерация изображений
│   │   └── generator.py
│   ├── utils/             # Утилиты
│   │   ├── config.py      # Конфигурация
│   │   └── logger.py      # Модульное логирование
│   └── main.py           # Точка входа
├── temp/                  # Временные файлы
├── logs/                  # Логи работы
└── docs/                  # Документация
```

### Принципы архитектуры
- **Модульность** - четкое разделение ответственности между компонентами
- **Асинхронность** - использование asyncio для высокой производительности
- **Минимализм** - отсутствие сложных middleware, фокус на основном функционале
- **Обработка ошибок** - комплексная система логирования и обработки исключений
- **Конфигурируемость** - гибкая настройка через файлы конфигурации

## Развертывание

### Окружение
- **Conda environment** для изоляции зависимостей
- **Python 3.9** как стабильная и производительная версия
- **Автоматическая установка** через готовые скрипты

### Конфигурация
- **Файл .env** для переменных окружения
- **Внешний YAML файл** для секретов (безопасность)
- **Модульная конфигурация** с валидацией параметров

### Запуск
- **Режим разработки** с автоматическим перезапуском
- **Продакшен режим** для стабильной работы
- **Мониторинг** через детальные логи

## Особенности реализации

### Безопасность
- **Rate limiting** - ограничение количества запросов от пользователя
- **Валидация файлов** - проверка размера и формата аудиофайлов
- **Очистка временных файлов** - автоматическое удаление после обработки
- **Безопасное хранение токенов** - вне основного кода

### Производительность
- **Ленивая загрузка моделей** - модели загружаются только при первом использовании
- **Кэширование** - повторное использование загруженных ресурсов
- **Оптимизация аудио** - автоматическая конвертация в оптимальный формат
- **Асинхронная обработка** - параллельная работа с множественными запросами

### Мониторинг и отладка
- **Модульное логирование** - отдельные логи для каждого компонента
- **Метрики производительности** - время обработки каждого этапа
- **Контекстные ошибки** - детальная информация об ошибках
- **Статистика использования** - трекинг действий пользователей

## Расширяемость

### Будущие возможности
- Интеграция с Hugging Face для AI-генерации изображений
- Поддержка множественных языков интерфейса
- Темы оформления и настраиваемые шаблоны
- Web-интерфейс для администрирования
- API для интеграции с другими сервисами
- Система кэширования результатов

### Модульная архитектура
Проект спроектирован для легкого добавления новых функций:
- Новые типы обработчиков сообщений
- Дополнительные форматы вывода
- Интеграция с внешними сервисами
- Альтернативные алгоритмы обработки
